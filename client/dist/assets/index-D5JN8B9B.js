const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ZI4kWCQR.js","assets/index-CDS5xYjb.css","assets/hashMessage-BJm_l2Uc.js","assets/checkContractWalletSignature-Ceniwij8.js","assets/isValidSignature-BC65HAuj.js","assets/checkContractWalletSignedTypedData-DdXKWuzs.js","assets/send-eip712-transaction-CUeAN12P.js","assets/eth_sendRawTransaction-DPdnXbFR.js","assets/concat-hex-aYp195_m.js","assets/sha256-DNLzVhVX.js"])))=>i.map(i=>d[i]);
import{B as bt,t as tt,i as Ot,a as Tt,b as L,A as Pt,c as q,f as et,k as v,d as at,e as R,I as Z,g as xt,h as nt,D as st,j as rt,l as Dt,P as _t,m as V,s as Lt,n as Et,v as Ct,o as D,p as b,r as E,q as Ut,u as It,w as St,x as Vt,E as T,y as $,z as it,C as Ft,F as G,M as Nt,G as Mt,H as ot,J as H,K as P,L as ct,N as Rt,O as B,Q as $t,R as K,S as Ht,T as dt,U as x,V as Bt,W as kt,X as jt,Y as zt,_ as w,Z as ut,$ as Wt,a0 as qt,a1 as Zt}from"./index-ZI4kWCQR.js";import{populateEip712Transaction as Kt,signEip712Transaction as Yt}from"./send-eip712-transaction-CUeAN12P.js";import{concatHex as Jt}from"./concat-hex-aYp195_m.js";import{m as Qt}from"./sha256-DNLzVhVX.js";class Xt extends bt{constructor(e){super(`Filter type "${e}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const I=tt;function te(t){const{abi:e,args:a=[],name:n}=t,r=Ot(n,{strict:!1}),s=e.filter(i=>r?i.type==="function"?Tt(i)===n:i.type==="event"?I(i)===n:!1:"name"in i&&i.name===n);if(s.length===0)return;if(s.length===1)return s[0];let o;for(const i of s){if(!("inputs"in i))continue;if(!a||a.length===0){if(!i.inputs||i.inputs.length===0)return i;continue}if(!i.inputs||i.inputs.length===0||i.inputs.length!==a.length)continue;if(a.every((d,m)=>{const p="inputs"in i&&i.inputs[m];return p?F(d,p):!1})){if(o&&"inputs"in o&&o.inputs){const d=pt(i.inputs,o.inputs,a);if(d)throw new Pt({abiItem:i,type:d[0]},{abiItem:o,type:d[1]})}o=i}}return o||s[0]}function F(t,e){const a=typeof t,n=e.type;switch(n){case"address":return L(t,{strict:!1});case"bool":return a==="boolean";case"function":return a==="string";case"string":return a==="string";default:return n==="tuple"&&"components"in e?Object.values(e.components).every((r,s)=>F(Object.values(t)[s],r)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(n)?a==="number"||a==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(n)?a==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(n)?Array.isArray(t)&&t.every(r=>F(r,{...e,type:n.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function pt(t,e,a){for(const n in t){const r=t[n],s=e[n];if(r.type==="tuple"&&s.type==="tuple"&&"components"in r&&"components"in s)return pt(r.components,s.components,a[n]);const o=[r.type,s.type];if(o.includes("address")&&o.includes("bytes20")?!0:o.includes("address")&&o.includes("string")?L(a[n],{strict:!1}):o.includes("address")&&o.includes("bytes")?L(a[n],{strict:!1}):!1)return o}}const Y="/docs/contract/encodeEventTopics";function ee(t){var c;const{abi:e,eventName:a,args:n}=t;let r=e[0];if(a){const d=te({abi:e,name:a});if(!d)throw new q(a,{docsPath:Y});r=d}if(r.type!=="event")throw new q(void 0,{docsPath:Y});const s=et(r),o=I(s);let i=[];if(n&&"inputs"in r){const d=(c=r.inputs)==null?void 0:c.filter(p=>"indexed"in p&&p.indexed),m=Array.isArray(n)?n:Object.values(n).length>0?(d==null?void 0:d.map(p=>n[p.name]))??[]:[];m.length>0&&(i=(d==null?void 0:d.map((p,f)=>Array.isArray(m[f])?m[f].map((g,h)=>J({param:p,value:m[f][h]})):m[f]?J({param:p,value:m[f]}):null))??[])}return[o,...i]}function J({param:t,value:e}){if(t.type==="string"||t.type==="bytes")return v(at(e));if(t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/))throw new Xt(t.type);return R([t],[e])}function ae(t,e){if(!L(t,{strict:!1}))throw new Z({address:t});if(!L(e,{strict:!1}))throw new Z({address:e});return t.toLowerCase()===e.toLowerCase()}const Q="/docs/contract/decodeEventLog";function ne(t){const{abi:e,data:a,strict:n,topics:r}=t,s=n??!0,[o,...i]=r;if(!o)throw new xt({docsPath:Q});const c=e.length===1?e[0]:e.find(u=>u.type==="event"&&o===I(et(u)));if(!(c&&"name"in c)||c.type!=="event")throw new nt(o,{docsPath:Q});const{name:d,inputs:m}=c,p=m==null?void 0:m.some(u=>!("name"in u&&u.name));let f=p?[]:{};const g=m.filter(u=>"indexed"in u&&u.indexed);for(let u=0;u<g.length;u++){const l=g[u],y=i[u];if(!y)throw new st({abiItem:c,param:l});f[p?u:l.name||u]=se({param:l,value:y})}const h=m.filter(u=>!("indexed"in u&&u.indexed));if(h.length>0){if(a&&a!=="0x")try{const u=rt(h,a);if(u)if(p)f=[...f,...u];else for(let l=0;l<h.length;l++)f[h[l].name]=u[l]}catch(u){if(s)throw u instanceof Dt||u instanceof _t?new V({abiItem:c,data:a,params:h,size:Lt(a)}):u}else if(s)throw new V({abiItem:c,data:"0x",params:h,size:0})}return{eventName:d,args:Object.values(f).length>0?f:void 0}}function se({param:t,value:e}){return t.type==="string"||t.type==="bytes"||t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/)?e:(rt([t],e)||[])[0]}function re(t){const{abi:e,args:a,logs:n,strict:r=!0}=t,s=(()=>{if(t.eventName)return Array.isArray(t.eventName)?t.eventName:[t.eventName]})();return n.map(o=>{var i;try{const c=e.find(m=>m.type==="event"&&o.topics[0]===I(m));if(!c)return null;const d=ne({...o,abi:[c],strict:r});return s&&!s.includes(d.eventName)||!ie({args:d.args,inputs:c.inputs,matchArgs:a})?null:{...d,...o}}catch(c){let d,m;if(c instanceof nt)return null;if(c instanceof V||c instanceof st){if(r)return null;d=c.abiItem.name,m=(i=c.abiItem.inputs)==null?void 0:i.some(p=>!("name"in p&&p.name))}return{...o,args:m?[]:{},eventName:d}}}).filter(Boolean)}function ie(t){const{args:e,inputs:a,matchArgs:n}=t;if(!n)return!0;if(!e)return!1;function r(s,o,i){try{return s.type==="address"?ae(o,i):s.type==="string"||s.type==="bytes"?v(at(o))===i:o===i}catch{return!1}}return Array.isArray(e)&&Array.isArray(n)?n.every((s,o)=>{if(s===null)return!0;const i=a[o];return i?(Array.isArray(s)?s:[s]).some(d=>r(i,d,e[o])):!1}):typeof e=="object"&&!Array.isArray(e)&&typeof n=="object"&&!Array.isArray(n)?Object.entries(n).every(([s,o])=>{if(o===null)return!0;const i=a.find(d=>d.name===s);return i?(Array.isArray(o)?o:[o]).some(d=>r(i,d,e[s])):!1}):!1}function oe(t){const{domain:e={},message:a,primaryType:n}=t,r={EIP712Domain:Et({domain:e}),...t.types};Ct({domain:e,message:a,primaryType:n,types:r});const s=["0x1901"];return e&&s.push(ce({domain:e,types:r})),n!=="EIP712Domain"&&s.push(lt({data:a,primaryType:n,types:r})),v(D(s))}function ce({domain:t,types:e}){return lt({data:t,primaryType:"EIP712Domain",types:e})}function lt({data:t,primaryType:e,types:a}){const n=mt({data:t,primaryType:e,types:a});return v(n)}function mt({data:t,primaryType:e,types:a}){const n=[{type:"bytes32"}],r=[de({primaryType:e,types:a})];for(const s of a[e]){const[o,i]=ft({types:a,name:s.name,type:s.type,value:t[s.name]});n.push(o),r.push(i)}return R(n,r)}function de({primaryType:t,types:e}){const a=b(ue({primaryType:t,types:e}));return v(a)}function ue({primaryType:t,types:e}){let a="";const n=yt({primaryType:t,types:e});n.delete(t);const r=[t,...Array.from(n).sort()];for(const s of r)a+=`${s}(${e[s].map(({name:o,type:i})=>`${i} ${o}`).join(",")})`;return a}function yt({primaryType:t,types:e},a=new Set){const n=t.match(/^\w*/u),r=n==null?void 0:n[0];if(a.has(r)||e[r]===void 0)return a;a.add(r);for(const s of e[r])yt({primaryType:s.type,types:e},a);return a}function ft({types:t,name:e,type:a,value:n}){if(t[a]!==void 0)return[{type:"bytes32"},v(mt({data:n,primaryType:a,types:t}))];if(a==="bytes")return n=`0x${(n.length%2?"0":"")+n.slice(2)}`,[{type:"bytes32"},v(n)];if(a==="string")return[{type:"bytes32"},v(b(n))];if(a.lastIndexOf("]")===a.length-1){const r=a.slice(0,a.lastIndexOf("[")),s=n.map(o=>ft({name:e,type:r,types:t,value:o}));return[{type:"bytes32"},v(R(s.map(([o])=>o),s.map(([,o])=>o)))]}return[{type:a},n]}const pe="0xdd62ed3e",le=[{type:"address",name:"owner"},{type:"address",name:"spender"}],me=[{type:"uint256"}];async function ye(t){return E({contract:t.contract,method:[pe,le,me],params:[t.owner,t.spender]})}async function fe(t){if(t.id===1337||t.id===31337)return!1;if(t.id===324||t.id===300||t.id===302||t.id===11124||t.id===282||t.id===388||t.id===4654||t.id===333271||t.id===37111)return!0;try{return(await Ut(t)).stackType==="zksync_stack"}catch{return!1}}function he(t){const{logs:e,events:a,strict:n}=t;return re({logs:e,abi:a.map(r=>r.abiEvent),strict:n})}function ge(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="event")}function ht(t){const{signature:e}=t;let a;return ge(e)?a=e:a=It(e),{abiEvent:a,hash:tt(a),topics:ee({abi:[a],args:t.filters})}}function Ae(t={}){return ht({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function Ge(t={}){return ht({signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function we(t){const{receipt:e}=t,a={...e,transactionHash:e.transactionHash,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs,to:e.to?e.to:null,transactionIndex:e.transactionIndex,status:e.status,type:e.type};return e.blobGasPrice&&(a.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(a.blobGasUsed=BigInt(e.blobGasUsed)),{...t,receipt:a,userOpHash:t.userOpHash,actualGasCost:BigInt(t.actualGasCost),actualGasUsed:BigInt(t.actualGasUsed),nonce:BigInt(t.nonce)}}const ve=()=>{const t=BigInt(Math.floor(Math.random()*4294967296)),e=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),r=BigInt(Math.floor(Math.random()*4294967296)),s=BigInt(Math.floor(Math.random()*4294967296));return t<<BigInt(160)|e<<BigInt(128)|a<<BigInt(96)|n<<BigInt(64)|r<<BigInt(32)|s};function k(t){return Object.fromEntries(Object.entries(t).map(([e,a])=>[e,a==null||St(a)?a:Vt(a)]))}async function be(t){return _({...t,operation:"eth_sendUserOperation",params:[k(t.userOp),t.options.entrypointAddress??T]})}async function C(t){const e=await _({...t,operation:"eth_estimateUserOperationGas",params:[k(t.userOp),t.options.entrypointAddress??T]});return{preVerificationGas:G(e.preVerificationGas),verificationGas:G(e.verificationGas),verificationGasLimit:G(e.verificationGasLimit),callGasLimit:G(e.callGasLimit)+Nt,paymasterVerificationGasLimit:e.paymasterVerificationGasLimit!==void 0?G(e.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:e.paymasterPostOpGasLimit!==void 0?G(e.paymasterPostOpGasLimit):void 0}}async function Oe(t){const e=await _({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:G(e.maxPriorityFeePerGas),maxFeePerGas:G(e.maxFeePerGas)}}async function Te(t){var a,n;const e=await Pe(t);if(e){if(e.success===!1){const s=(n=(a=he({events:[Ae(),Ge()],logs:e.logs})[0])==null?void 0:a.args)==null?void 0:n.revertReason;if(!s)throw new Error(`UserOp failed at txHash: ${e.receipt.transactionHash}`);const o=Mt({data:s});throw new Error(`UserOp failed with reason: '${o.args.join(",")}' at txHash: ${e.receipt.transactionHash}`)}return e.receipt}}async function Pe(t){const e=await _({options:t,operation:"eth_getUserOperationReceipt",params:[t.userOpHash]});if(e)return we(e)}async function xe(t){const e=await _({options:t.options,operation:"zk_paymasterData",params:[t.transaction]});return{paymaster:e.paymaster,paymasterInput:e.paymasterInput}}async function De(t){return{transactionHash:(await _({options:t.options,operation:"zk_broadcastTransaction",params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}async function _(t){const{options:e,operation:a,params:n}=t,r=e.bundlerUrl??$(e.chain),o=await it(e.client)(r,{method:"POST",headers:{"Content-Type":"application/json"},body:Ft({jsonrpc:"2.0",id:1,method:a,params:n})}),i=await o.json();if(!o.ok||i.error){let c=i.error||o.statusText;typeof c=="object"&&(c=JSON.stringify(c));const d=i.code||"UNKNOWN";throw new Error(`${a} error: ${c}
Status: ${o.status}
Code: ${d}`)}return i.result}async function _e(t){const{factoryContract:e,predictAddressOverride:a,adminAddress:n,accountSalt:r,accountAddress:s}=t;if(a)return a(e);if(s)return s;if(!n)throw new Error("Account address is required to predict the smart wallet address.");const o=ot(r??"");return E({contract:e,method:"function getAddress(address, bytes) returns (address)",params:[n,o]})}function gt(t){const{adminAddress:e,factoryContract:a,createAccountOverride:n,accountSalt:r}=t;return n?n(a):H({contract:a,method:"function createAccount(address, bytes) returns (address)",params:[e,ot(r??"")]})}function At(t){const{accountContract:e,transaction:a,executeOverride:n}=t;return n?n(e,a):H({contract:e,method:"function execute(address, uint256, bytes)",params:[a.to||"",a.value||0n,a.data||"0x"]})}function Le(t){const{accountContract:e,transactions:a,executeBatchOverride:n}=t;return n?n(e,a):H({contract:e,method:"function executeBatch(address[], uint256[], bytes[])",params:[a.map(r=>r.to||""),a.map(r=>r.value||0n),a.map(r=>r.data||"0x")]})}const Ee="0x35567e1a",Ce=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],Ue=[{type:"uint256",name:"nonce"}];async function Ie(t){return E({contract:t.contract,method:[Ee,Ce,Ue],params:[t.sender,t.key]})}const Se="0xa6193531",Ve=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],Fe=[{type:"bytes32"}];async function Ne(t){return E({contract:t.contract,method:[Se,Ve,Fe],params:[t.userOp]})}const Me="0x22cdde4c",Re=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],$e=[{type:"bytes32"}];async function He(t){return E({contract:t.contract,method:[Me,Re,$e],params:[t.userOp]})}function Be(t){return t.factory?D([t.factory,t.factoryData||"0x"]):"0x"}function ke(t){return D([P(b(t.verificationGasLimit),{size:16}),P(b(t.callGasLimit),{size:16})])}function je(t){return D([P(b(t.maxPriorityFeePerGas),{size:16}),P(b(t.maxFeePerGas),{size:16})])}function ze(t){return t.paymaster?D([t.paymaster,P(b(t.paymasterVerificationGasLimit||BigInt(0)),{size:16}),P(b(t.paymasterPostOpGasLimit||BigInt(0)),{size:16}),t.paymasterData||"0x"]):"0x"}const We=t=>({sender:t.sender,nonce:t.nonce,initCode:Be(t),callData:t.callData,accountGasLimits:ke(t),preVerificationGas:t.preVerificationGas,gasFees:je(t),paymasterAndData:ze(t),signature:t.signature});async function U(t){var g;const{userOp:e,paymasterOverride:a,client:n,chain:r,entrypointAddress:s}=t;if(a)return a(e);const o={"Content-Type":"application/json"},i=s??T,c=$(r),m=await it(n)(c,{method:"POST",headers:o,body:JSON.stringify({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[k(e),i]})}),p=await m.json();if(!m.ok){const h=p.error||m.statusText,u=p.code||"UNKNOWN";throw new Error(`Paymaster error: ${h}
Status: ${m.status}
Code: ${u}`)}if(p.result)return typeof p.result=="string"?{paymasterAndData:p.result}:{paymasterAndData:p.result.paymasterAndData,verificationGasLimit:p.result.verificationGasLimit?G(p.result.verificationGasLimit):void 0,preVerificationGas:p.result.preVerificationGas?G(p.result.preVerificationGas):void 0,callGasLimit:p.result.callGasLimit?G(p.result.callGasLimit):void 0,paymaster:p.result.paymaster,paymasterData:p.result.paymasterData,paymasterVerificationGasLimit:p.result.paymasterVerificationGasLimit?G(p.result.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:p.result.paymasterPostOpGasLimit?G(p.result.paymasterPostOpGasLimit):void 0};const f=((g=p.error)==null?void 0:g.message)||p.error||m.statusText||"unknown error";throw new Error(`Paymaster error from ${c}: ${f}`)}const j=new Set,z=t=>`${t.chain.id}:${t.address}`,Gt=t=>{j.add(z(t))},qe=t=>{j.delete(z(t))},W=t=>j.has(z(t));async function Ze(t){const e=t.timeoutMs||12e4,a=t.intervalMs||1e3,n=Date.now()+e;for(;Date.now()<n;){const r=await Te(t);if(r)return r;await new Promise(s=>setTimeout(s,a))}throw new Error("Timeout waiting for userOp to be mined")}async function Ke(t){var y;const{transaction:e,accountContract:a,factoryContract:n,adminAddress:r,overrides:s,sponsorGas:o}=t,i=e.chain,c=e.client,d={client:c,chain:i,entrypointAddress:s==null?void 0:s.entrypointAddress},m=ct(((y=t.overrides)==null?void 0:y.entrypointAddress)||T),[p,f,g,h]=await Promise.all([Rt(a),B(e),Ye({executeTx:e,bundlerOptions:d,chain:i,client:c}),ea({accountContract:a,chain:i,client:c,entrypointAddress:s==null?void 0:s.entrypointAddress,getNonceOverride:s==null?void 0:s.getAccountNonce})]),{maxFeePerGas:u,maxPriorityFeePerGas:l}=g;return m==="v0.7"?Je({bundlerOptions:d,factoryContract:n,accountContract:a,adminAddress:r,sponsorGas:o,overrides:s,isDeployed:p,nonce:h,callData:f,maxFeePerGas:u,maxPriorityFeePerGas:l}):Qe({bundlerOptions:d,factoryContract:n,accountContract:a,adminAddress:r,sponsorGas:o,overrides:s,isDeployed:p,nonce:h,callData:f,maxFeePerGas:u,maxPriorityFeePerGas:l})}async function Ye(t){const{executeTx:e,bundlerOptions:a,chain:n,client:r}=t;let{maxFeePerGas:s,maxPriorityFeePerGas:o}=e;const i=(a==null?void 0:a.bundlerUrl)??$(n);if($t(i)){const c=await Oe({options:a});s=c.maxFeePerGas,o=c.maxPriorityFeePerGas}else{const[c,d]=await Promise.all([K(s),K(o)]);if(c&&d)s=c,o=d;else{const m=await Ht(r,n);o=d??m.maxPriorityFeePerGas??0n,s=c??m.maxFeePerGas??0n}}return{maxFeePerGas:s,maxPriorityFeePerGas:o}}async function Je(t){const{bundlerOptions:e,isDeployed:a,factoryContract:n,accountContract:r,adminAddress:s,sponsorGas:o,overrides:i,nonce:c,callData:d,maxFeePerGas:m,maxPriorityFeePerGas:p}=t,{chain:f,client:g}=e;let h,u;a||W(r)?(u="0x",await wt(r)):(h=n.address,u=await B(gt({factoryContract:n,adminAddress:s,accountSalt:i==null?void 0:i.accountSalt,createAccountOverride:i==null?void 0:i.createAccount})),Gt(r));const l={sender:r.address,nonce:c,callData:d,maxFeePerGas:m,maxPriorityFeePerGas:p,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,factory:h,factoryData:u,paymaster:void 0,paymasterData:"0x",paymasterVerificationGasLimit:0n,paymasterPostOpGasLimit:0n,signature:dt};if(o){const y=await U({userOp:l,chain:f,client:g,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster});if(y.paymaster&&y.paymasterData&&(l.paymaster=y.paymaster,l.paymasterData=y.paymasterData),y.callGasLimit&&y.verificationGasLimit&&y.preVerificationGas&&y.paymasterPostOpGasLimit&&y.paymasterVerificationGasLimit)l.callGasLimit=y.callGasLimit,l.verificationGasLimit=y.verificationGasLimit,l.preVerificationGas=y.preVerificationGas,l.paymasterPostOpGasLimit=y.paymasterPostOpGasLimit,l.paymasterVerificationGasLimit=y.paymasterVerificationGasLimit;else{const A=await C({userOp:l,options:e});l.callGasLimit=A.callGasLimit,l.verificationGasLimit=A.verificationGasLimit,l.preVerificationGas=A.preVerificationGas,l.paymasterPostOpGasLimit=y.paymasterPostOpGasLimit||0n,l.paymasterVerificationGasLimit=y.paymasterVerificationGasLimit||0n;const O=await U({userOp:l,chain:f,client:g,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster});O.paymaster&&O.paymasterData&&(l.paymaster=O.paymaster,l.paymasterData=O.paymasterData)}}else{const y=await C({userOp:l,options:e});l.callGasLimit=y.callGasLimit,l.verificationGasLimit=y.verificationGasLimit,l.preVerificationGas=y.preVerificationGas,l.paymasterPostOpGasLimit=y.paymasterPostOpGasLimit||0n,l.paymasterVerificationGasLimit=y.paymasterVerificationGasLimit||0n}return{...l,signature:"0x"}}async function Qe(t){const{bundlerOptions:e,isDeployed:a,factoryContract:n,accountContract:r,adminAddress:s,sponsorGas:o,overrides:i,nonce:c,callData:d,maxFeePerGas:m,maxPriorityFeePerGas:p}=t,{chain:f,client:g}=e;let h;a||W(r)?(h="0x",await wt(r)):(h=await ta({factoryContract:n,adminAddress:s,accountSalt:i==null?void 0:i.accountSalt,createAccountOverride:i==null?void 0:i.createAccount}),Gt(r));const u={sender:r.address,nonce:c,initCode:h,callData:d,maxFeePerGas:m,maxPriorityFeePerGas:p,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:dt};if(o){const l=await U({userOp:u,chain:f,client:g,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster}),y="paymasterAndData"in l?l.paymasterAndData:"0x";if(y&&y!=="0x"&&(u.paymasterAndData=y),l.callGasLimit&&l.verificationGasLimit&&l.preVerificationGas)u.callGasLimit=l.callGasLimit,u.verificationGasLimit=l.verificationGasLimit,u.preVerificationGas=l.preVerificationGas;else{const A=await C({userOp:u,options:e});if(u.callGasLimit=A.callGasLimit,u.verificationGasLimit=A.verificationGasLimit,u.preVerificationGas=A.preVerificationGas,y&&y!=="0x"){const O=await U({userOp:u,chain:f,client:g,entrypointAddress:i==null?void 0:i.entrypointAddress,paymasterOverride:i==null?void 0:i.paymaster}),S="paymasterAndData"in O?O.paymasterAndData:"0x";S&&S!=="0x"&&(u.paymasterAndData=S)}}}else{const l=await C({userOp:u,options:e});u.callGasLimit=l.callGasLimit,u.verificationGasLimit=l.verificationGasLimit,u.preVerificationGas=l.preVerificationGas}return{...u,signature:"0x"}}async function Xe(t){const{userOp:e,chain:a,entrypointAddress:n,adminAccount:r}=t,s=ct(n||T);let o;if(s==="v0.7"){const i=We(e);o=await He({contract:x({address:n||Bt,chain:a,client:t.client}),userOp:i})}else o=await Ne({contract:x({address:n||T,chain:a,client:t.client}),userOp:e});if(r.signMessage){const i=await r.signMessage({message:{raw:kt(o)}});return{...e,signature:i}}throw new Error("signMessage not implemented in signingAccount")}async function ta(t){const{factoryContract:e,adminAddress:a,accountSalt:n,createAccountOverride:r}=t,s=gt({factoryContract:e,adminAddress:a,accountSalt:n,createAccountOverride:r});return D([e.address,await B(s)])}async function ea(t){const{accountContract:e,chain:a,client:n,entrypointAddress:r,getNonceOverride:s}=t;return s?s(e):Ie({contract:x({address:r||T,chain:a,client:n}),key:ve(),sender:e.address})}async function wt(t){const e=Date.now();for(;W(t);){if(Date.now()-e>6e4)throw new Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(a=>setTimeout(a,500))}}function aa(t){return t.id==="smart"}const vt=new WeakMap,N=new WeakMap;async function na(t,e,a){var h,u,l,y;const{personalAccount:n,client:r,chain:s}=e;if(!n)throw new Error("Personal wallet does not have an account");const o=a,i=o.factoryAddress??jt((h=a.overrides)==null?void 0:h.entrypointAddress),c=s??o.chain,d="gasless"in o?o.gasless:o.sponsorGas;if(await fe(c))return[oa({creationOptions:a,connectionOptions:e,chain:c,sponsorGas:d}),c];const m=x({client:r,address:i,chain:c}),p=await _e({factoryContract:m,adminAddress:n.address,predictAddressOverride:(u=o.overrides)==null?void 0:u.predictAddress,accountSalt:(l=o.overrides)==null?void 0:l.accountSalt,accountAddress:(y=o.overrides)==null?void 0:y.accountAddress}).then(A=>A).catch(A=>{throw new Error(`Failed to get account address with factory contract ${m.address} on chain ID ${c.id}: ${(A==null?void 0:A.message)||"unknown error"}`,{cause:A})}),f=x({client:r,address:p,chain:c}),g=await ra({...o,chain:c,sponsorGas:d,personalAccount:n,accountContract:f,factoryContract:m,client:r});return vt.set(n,t),N.set(t,n),[g,c]}async function sa(t){const e=N.get(t);e&&(vt.delete(e),N.delete(t))}async function ra(t){const{accountContract:e}=t,a={address:zt(e.address),async sendTransaction(n){var i,c,d;const r=(i=t.overrides)==null?void 0:i.erc20Paymaster;let s;if(r){await ia({accountContract:e,erc20Paymaster:r,options:t});const m=async()=>({paymasterAndData:Jt([r.address,r==null?void 0:r.token]),paymaster:r.address,paymasterData:"0x"});s=((c=t.overrides)==null?void 0:c.paymaster)||m}const o=At({accountContract:e,transaction:n,executeOverride:(d=t.overrides)==null?void 0:d.execute});return M({executeTx:o,options:{...t,overrides:{...t.overrides,paymaster:s}}})},async sendBatchTransaction(n){var s;const r=Le({accountContract:e,transactions:n,executeBatchOverride:(s=t.overrides)==null?void 0:s.executeBatch});return M({executeTx:r,options:t})},async signMessage({message:n}){const[{isContractDeployed:r},{readContract:s},{encodeAbiParameters:o},{hashMessage:i},{checkContractWalletSignature:c}]=await Promise.all([w(()=>import("./index-ZI4kWCQR.js").then(h=>h.d9),__vite__mapDeps([0,1])),w(()=>import("./index-ZI4kWCQR.js").then(h=>h.db),__vite__mapDeps([0,1])),w(()=>import("./index-ZI4kWCQR.js").then(h=>h.da),__vite__mapDeps([0,1])),w(()=>import("./hashMessage-BJm_l2Uc.js"),__vite__mapDeps([2,0,1])),w(()=>import("./checkContractWalletSignature-Ceniwij8.js"),__vite__mapDeps([3,4,0,1]))]);await r(e)||await X({options:t,account:a,accountContract:e});const m=i(n);let p=!1;try{await s({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[m]}),p=!0}catch{}let f;if(p){const h=o([{type:"bytes32"}],[m]);f=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:h}})}else f=await t.personalAccount.signMessage({message:n});if(await c({contract:e,message:n,signature:f}))return f;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(n){var u,l,y;const r=ut(n),[{isContractDeployed:s},{readContract:o},{encodeAbiParameters:i},{checkContractWalletSignedTypedData:c}]=await Promise.all([w(()=>import("./index-ZI4kWCQR.js").then(A=>A.d9),__vite__mapDeps([0,1])),w(()=>import("./index-ZI4kWCQR.js").then(A=>A.db),__vite__mapDeps([0,1])),w(()=>import("./index-ZI4kWCQR.js").then(A=>A.da),__vite__mapDeps([0,1])),w(()=>import("./checkContractWalletSignedTypedData-DdXKWuzs.js"),__vite__mapDeps([5,4,0,1,6,7,8,9]))]);if(((l=(u=r.domain)==null?void 0:u.verifyingContract)==null?void 0:l.toLowerCase())===((y=e.address)==null?void 0:y.toLowerCase()))return t.personalAccount.signTypedData(r);await s(e)||await X({options:t,account:a,accountContract:e});const p=oe(r);let f=!1;try{await o({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[p]}),f=!0}catch{}let g;if(f){const A=i([{type:"bytes32"}],[p]);g=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:A}})}else g=await t.personalAccount.signTypedData(r);if(await c({contract:e,data:r,signature:g}))return g;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async onTransactionRequested(n){var r,s;return(s=(r=t.personalAccount).onTransactionRequested)==null?void 0:s.call(r,n)}};return a}async function ia(t){var m;const{accountContract:e,erc20Paymaster:a,options:n}=t,r=a.token,s=x({address:r,chain:e.chain,client:e.client});if(await ye({contract:s,owner:e.address,spender:a.address})>0n)return;const i=Wt({contract:s,spender:a.address,amountWei:Qt-1n}),c=await qt({transaction:i,from:e.address}),d=At({accountContract:e,transaction:c,executeOverride:(m=n.overrides)==null?void 0:m.execute});await M({executeTx:d,options:{...n,overrides:{...n.overrides,erc20Paymaster:void 0}}})}function oa(t){const{creationOptions:e,connectionOptions:a,chain:n}=t,r={address:a.personalAccount.address,async sendTransaction(s){var m,p,f,g;const o={data:s.data,to:s.to??void 0,value:s.value??0n,chain:Zt(s.chainId),client:a.client};let i=await Kt({account:r,transaction:o});if(t.sponsorGas){const h=await xe({options:{client:a.client,chain:n,bundlerUrl:(m=e.overrides)==null?void 0:m.bundlerUrl,entrypointAddress:(p=e.overrides)==null?void 0:p.entrypointAddress},transaction:i});i={...i,...h}}const c=await Yt({account:r,chainId:n.id,eip712Transaction:i});return{transactionHash:(await De({options:{client:a.client,chain:n,bundlerUrl:(f=e.overrides)==null?void 0:f.bundlerUrl,entrypointAddress:(g=e.overrides)==null?void 0:g.entrypointAddress},transaction:i,signedTransaction:c})).transactionHash,client:a.client,chain:n}},async signMessage({message:s}){return a.personalAccount.signMessage({message:s})},async signTypedData(s){const o=ut(s);return a.personalAccount.signTypedData(o)},async onTransactionRequested(s){var o,i;return(i=(o=a.personalAccount).onTransactionRequested)==null?void 0:i.call(o,s)}};return r}async function X(t){const{options:e,account:a,accountContract:n}=t,[{sendTransaction:r},{prepareTransaction:s}]=await Promise.all([w(()=>import("./index-ZI4kWCQR.js").then(c=>c.dd),__vite__mapDeps([0,1])),w(()=>import("./index-ZI4kWCQR.js").then(c=>c.dc),__vite__mapDeps([0,1]))]),o=s({client:e.client,chain:e.chain,to:n.address,value:0n,gas:50000n});return await r({transaction:o,account:a})}async function M(t){var c,d,m;const{executeTx:e,options:a}=t,n=await Ke({transaction:e,factoryContract:a.factoryContract,accountContract:a.accountContract,adminAddress:a.personalAccount.address,sponsorGas:a.sponsorGas,overrides:a.overrides}),r=await Xe({client:a.client,chain:a.chain,adminAccount:a.personalAccount,entrypointAddress:(c=a.overrides)==null?void 0:c.entrypointAddress,userOp:n}),s={chain:a.chain,client:a.client,bundlerUrl:(d=a.overrides)==null?void 0:d.bundlerUrl,entrypointAddress:(m=a.overrides)==null?void 0:m.entrypointAddress},o=await be({options:s,userOp:r}),i=await Ze({...a,userOpHash:o});return qe(a.accountContract),{client:a.client,chain:a.chain,transactionHash:i.transactionHash}}const la=Object.freeze(Object.defineProperty({__proto__:null,connectSmartWallet:na,disconnectSmartWallet:sa,isSmartWallet:aa},Symbol.toStringTag,{value:"Module"}));export{oe as h,la as i};
