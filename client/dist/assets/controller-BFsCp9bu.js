const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-Dh4pkFYD.js","assets/index-ZI4kWCQR.js","assets/index-CDS5xYjb.css"])))=>i.map(i=>d[i]);
import{B as j,al as z,am as B,ag as R,a1 as p,an as x,_ as O,ao as Y,ap as I,q as $,ah as q,ai as K,aq as N,ar as Z,Y as H,as as k,at as G,H as X,a2 as ee,Z as ae,n as ne,v as te,ak as ie}from"./index-ZI4kWCQR.js";const se=e=>e;class re extends j{constructor({body:t,error:n,url:r}){super("RPC Request failed.",{cause:n,details:n.message,metaMessages:[`URL: ${se(r)}`,`Request body: ${z(t)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=n.code}}const ce=-1;class oe extends j{constructor(t,{code:n,docsPath:r,metaMessages:i,name:a,shortMessage:s}){super(s,{cause:t,docsPath:r,metaMessages:i||(t==null?void 0:t.metaMessages),name:a||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=a||t.name,this.code=t instanceof re?t.code:n??ce}}class F extends oe{constructor(t,n){super(t,n),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=n.data}}class P extends F{constructor(t){super(t,{code:P.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(P,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class _ extends F{constructor(t){super(t,{code:_.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(_,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});const S="wallet_addEthereumChain",de=!0,M={requestedChains:"tw.wc.requestedChains",lastUsedChainId:"tw.wc.lastUsedChainId"};async function Ce(e,t,n,r,i){var y,T;const a=await V(e,n,i),s=e.walletConnect;let{onDisplayUri:o}=s||{};if(!o&&i&&n!=="walletConnect"){const m=await x(n);o=C=>{const E=m.mobile.native||m.mobile.universal;if(!E)throw new Error("No app url found for wallet connect to redirect to.");const v=G(E,C).redirect;i(v)}}o&&a.events.addListener("display_uri",o);let l=s==null?void 0:s.optionalChains,c=e.chain;n==="global.safe"&&(l=J.map(p),c&&!l.includes(c)&&(c=void 0));const{rpcMap:d,requiredChain:u,optionalChains:f}=Q({client:e.client,chain:c,optionalChains:l});a.session&&await a.connect({...s!=null&&s.pairingTopic?{pairingTopic:s==null?void 0:s.pairingTopic}:{},optionalChains:f,chains:u?[u.id]:void 0,rpcMap:d}),U(f,r);const h=(await a.enable())[0];if(!h)throw new Error("No accounts found on provider.");const g=R(a.chainId),b=e.chain&&e.chain.id===g?e.chain:p(g);if(e){const m={optionalChains:(y=e.walletConnect)==null?void 0:y.optionalChains,chain:e.chain,pairingTopic:(T=e.walletConnect)==null?void 0:T.pairingTopic};r&&Z(r,n,m)}return s!=null&&s.onDisplayUri&&a.events.removeListener("display_uri",s.onDisplayUri),W(h,b,a,t,r)}async function pe(e,t,n,r,i){const a=r?await B(r,n):null,s=await V(a?{chain:a.chain,client:e.client,walletConnect:{pairingTopic:a.pairingTopic,optionalChains:a.optionalChains}}:{client:e.client,walletConnect:{}},n,i,!0),o=s.accounts[0];if(!o)throw new Error("No accounts found on provider.");const l=R(s.chainId),c=e.chain&&e.chain.id===l?e.chain:p(l);return W(o,c,s,t,r)}async function V(e,t,n,r=!1){var g,b,y,T;const i=await x(t),a=e.walletConnect,{EthereumProvider:s,OPTIONAL_EVENTS:o,OPTIONAL_METHODS:l}=await O(async()=>{const{EthereumProvider:m,OPTIONAL_EVENTS:w,OPTIONAL_METHODS:C}=await import("./index.es-Dh4pkFYD.js");return{EthereumProvider:m,OPTIONAL_EVENTS:w,OPTIONAL_METHODS:C}},__vite__mapDeps([0,1,2]));let c=a==null?void 0:a.optionalChains,d=e.chain;t==="global.safe"&&(c=J.map(p),d&&!c.includes(d)&&(d=void 0));const{rpcMap:u,requiredChain:f,optionalChains:D}=Q({client:e.client,chain:d,optionalChains:c}),h=await s.init({showQrModal:(a==null?void 0:a.showQrModal)===void 0?n?!1:de:a.showQrModal,projectId:(a==null?void 0:a.projectId)||Y,optionalMethods:l,optionalEvents:o,optionalChains:D,chains:f?[f.id]:void 0,metadata:{name:((g=a==null?void 0:a.appMetadata)==null?void 0:g.name)||I().name,description:((b=a==null?void 0:a.appMetadata)==null?void 0:b.description)||I().description,url:((y=a==null?void 0:a.appMetadata)==null?void 0:y.url)||I().url,icons:[((T=a==null?void 0:a.appMetadata)==null?void 0:T.logoUrl)||I().logoUrl]},rpcMap:u,qrModalOptions:a==null?void 0:a.qrModalOptions,disableProviderPing:!0});if(h.events.setMaxListeners(Number.POSITIVE_INFINITY),r||h.session&&await h.disconnect(),t!=="walletConnect"){async function m(){var C,E,v,A;const w=((A=(v=(E=(C=h.session)==null?void 0:C.peer)==null?void 0:E.metadata)==null?void 0:v.redirect)==null?void 0:A.native)||i.mobile.native||i.mobile.universal;n&&w&&await n(w)}h.signer.client.on("session_request_sent",m),h.events.addListener("disconnect",()=>{h.signer.client.off("session_request_sent",m)})}return h}function L(e,t){return{address:H(t),async sendTransaction(i){return{transactionHash:await e.request({method:"eth_sendTransaction",params:[{gas:i.gas?q(i.gas):void 0,value:i.value?q(i.value):void 0,from:this.address,to:i.to,data:i.data}]})}},async signMessage({message:i}){const a=typeof i=="string"?X(i):i.raw instanceof Uint8Array?ee(i.raw):i.raw;return e.request({method:"personal_sign",params:[a,this.address]})},async signTypedData(i){const a=ae(i),{domain:s,message:o,primaryType:l}=a,c={EIP712Domain:ne({domain:s}),...a.types};te({domain:s,message:o,primaryType:l,types:c});const d=ie({domain:s??{},message:o,primaryType:l,types:c});return await e.request({method:"eth_signTypedData_v4",params:[this.address,d]})}}}function W(e,t,n,r,i){const a=L(n,e);async function s(){n.removeListener("accountsChanged",l),n.removeListener("chainChanged",c),n.removeListener("disconnect",o),await n.disconnect()}function o(){U([],i),i==null||i.removeItem(M.lastUsedChainId),s(),r.emit("disconnect",void 0)}function l(d){if(d[0]){const u=L(n,H(d[0]));r.emit("accountChanged",u),r.emit("accountsChanged",d)}else o()}function c(d){const u=p(R(d));r.emit("chainChanged",u),i==null||i.setItem(M.lastUsedChainId,String(d))}return n.on("accountsChanged",l),n.on("chainChanged",c),n.on("disconnect",o),n.on("session_delete",o),[a,t,s,d=>he(n,d,i)]}function le(e){var t,n;return((n=(t=e.session)==null?void 0:t.namespaces[k])==null?void 0:n.methods)||[]}function ue(e){var n,r,i;return((i=(r=(n=e.session)==null?void 0:n.namespaces[k])==null?void 0:r.chains)==null?void 0:i.map(a=>Number.parseInt(a.split(":")[1]||"")))??[]}async function he(e,t,n){var i,a;const r=t.id;try{const s=ue(e),o=le(e);if(!s.includes(r)&&o.includes(S)){const c=await $(t),d=[...new Set([...((i=t.blockExplorers)==null?void 0:i.map(f=>f.url))||[],...((a=c.explorers)==null?void 0:a.map(f=>f.url))||[]])];await e.request({method:S,params:[{chainId:q(c.chainId),chainName:c.name,nativeCurrency:c.nativeCurrency,rpcUrls:K(c),blockExplorerUrls:d.length>0?d:void 0}]});const u=await fe(n);u.push(r),U(u,n)}await e.request({method:"wallet_switchEthereumChain",params:[{chainId:q(r)}]})}catch(s){const o=typeof s=="string"?s:s==null?void 0:s.message;throw/user rejected request/i.test(o)?new P(s):new _(s)}}function U(e,t){t==null||t.setItem(M.requestedChains,JSON.stringify(e))}async function fe(e){const t=await e.getItem(M.requestedChains);return t?JSON.parse(t):[]}function Q(e){const t={};e.chain&&(t[e.chain.id]=N({chain:e.chain,client:e.client}));const n=((e==null?void 0:e.optionalChains)||[]).slice(0,10);for(const r of n)t[r.id]=N({chain:r,client:e.client});return!e.chain&&n.length===0&&(t[1]=p(1).rpc),{rpcMap:t,requiredChain:e.chain?e.chain:void 0,optionalChains:n.length>0?n.map(r=>r.id):[1]}}const J=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{pe as autoConnectWC,Ce as connectWC};
